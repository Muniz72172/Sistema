üß≠ Sistema Web de Marca√ß√£o de √înibus ‚Äì PNSPA (Vers√£o 2025)
üîê 1. Acesso ao Sistema
O acesso inicial se d√° via login.html, com valida√ß√£o por NIP e senha criptografada (SHA‚Äë256 + Base64).

Senha verificada em UsuariosCadastrados (p√∫blico geral) ou LoginAdminOnibus (painel de administra√ß√£o).

Valida√ß√£o considera status ativo e consist√™ncia com a base FUSMAOFF.

Roteamento controlado via ?page= e fun√ß√£o doGet(e).

üÜï 2. Cadastro Validado
Para novos usu√°rios:

cadastroValidacao.html cruza NIP + data de nascimento com a aba ValidacaoFusma.

Ap√≥s valida√ß√£o, cadastroFinal.html conclui o registro.

Dados v√£o para UsuariosCadastrados e logs em LogsCadastro.

‚öôÔ∏è 3. Menu Principal ‚Äì menu.html
Tela inicial para usu√°rios autenticados:

Bot√µes: Marcar √înibus, Meus Agendamentos, Alterar Cadastro, Sair.

Avisos din√¢micos (aba Avisos) apresentados conforme relev√¢ncia.

üöå 4. Marca√ß√£o de √înibus ‚Äì onibus.html
4.1 Escolha da Data e Verifica√ß√£o
Datas ativas s√£o carregadas da aba ConfigOnibus.

Usu√°rio s√≥ pode marcar 1 viagem por data.

Se √¥nibus estiver lotado, exibe op√ß√£o de entrar na Fila de Espera.

4.2 Fluxo com Vaga Dispon√≠vel
Sele√ß√£o visual de assentos (mapa).

Flags: PCD, acompanhante.

Fluxo:

instrucoesOnibus.html

formularioOnibus[Com|Sem]Acompanhante.html

Confirma√ß√£o ‚Üí registrarAgendamento()

Registros: Agendamentos, HistoricoUsuarios, HistoricoGeralUsuarios.

4.3 Fluxo de Fila de Espera
Entrada quando √¥nibus estiver lotado.

Fluxo registra como Reserva, com assento R01, R02 etc.

Fun√ß√£o registrarFilaDeEspera() grava tamb√©m em LogsFilaEspera.

ü™ë 5. Regras da Fila de Espera
Promo√ß√£o autom√°tica: at√© 24h antes da viagem (processarAlocacaoFilaDiaria()).

Ap√≥s 24h: promo√ß√£o apenas presencialmente pelo admin.

Assentos 3 e 4 t√™m prioridade para PCDs.

üëÄ 6. Meus Agendamentos ‚Äì meusAgendamentos.html
Exibe agendamentos e reservas do usu√°rio.

Destaque visual: ‚úÖ Confirmado | üïó Reserva

Bot√£o ‚ÄúCancelar‚Äù ‚Üí remove do sistema e aciona promo√ß√£o da fila.

üîÑ 7. Cancelamento
Pode ser feito pelo usu√°rio ou pelo admin.

Atualiza logs e chama processarAlocacaoFilaDiaria() se aplic√°vel.

üìã 8. Painel Administrativo ‚Äì Nova Interface
üö™ Acesso de Administrador
Via loginAdmin.html, com NIP e senha.

‚ÄúPrimeiro acesso‚Äù passa por:

validarCadastroAdminOnibus.html

cadastroSenhaAdminOnibus.html

üßë‚Äçüíº adminOnibus.html
Fun√ß√µes principais do painel:

Fun√ß√£o	Descri√ß√£o
Filtro de Data e Destino	Permite selecionar a opera√ß√£o que ser√° gerenciada
Gerenciar Datas	L√™ e escreve em ConfigOnibus (ativa/inativa datas espec√≠ficas)
Listar Agendados	Exibe passageiros confirmados, com op√ß√µes para Cancelar ou Lan√ßar Falta
Listar Fila de Espera	Exibe reservas, permite Promover ou Cancelar
Libera√ß√£o de Assento Dirigida	Libera assento cinza (43‚Äì46) para um NIP espec√≠fico com justificativa
Gerar Lista de Presen√ßa	Gera documento com NIP, nome, assento, PCD, acompanhante e campo de assinatura

üîê Seguran√ßa e Controle
Painel acess√≠vel somente com sessionStorage v√°lido (nipAdminOnibus, nomeAdminOnibus)

Logs de todas as a√ß√µes s√£o gravados em Registro_Onibus

Senhas criptografadas e validadas no back-end

Auditoria total via hist√≥rico, inclusive para admins

üìÇ Scripts e Abas Envolvidas
üìú Scripts
Login.gs, CadastroValidado.gs, MarcacaoOnibus.gs, AdminOnibus.gs, MeusAgendamentos.gs, Utilitarios.gs

üìë Abas da planilha
UsuariosCadastrados, Agendamentos, Reservas, ConfigOnibus, HistoricoUsuarios, HistoricoGeralUsuarios, Registro_Onibus, Cancelamentos, LoginAdminOnibus, AssentosOnibus, LogsFilaEspera

Mais detalhes:

## Sistema Web de Marca√ß√£o e Administra√ß√£o de Transporte - PNSPA (2025)

### ‚ú® Vis√£o Geral

O sistema da Policl√≠nica Naval de S√£o Pedro da Aldeia (PNSPA) permite que militares agendem viagens de √¥nibus institucionais para destinos como HNMD, PNNSG e OCM. Integra funcionalidades de marca√ß√£o online, controle de assentos, fila de espera e um painel administrativo seguro e rastre√°vel, gerenciado por servidores autorizados.

---

### üîê 1. Acesso e Autentica√ß√£o

#### A) Login Geral (`login.html`)

* **Entrada**: NIP e senha criptografada (SHA-256 + Base64)
* **Valida√ß√£o**: Aba `UsuariosCadastrados`, ativo e autenticado
* **Roteamento**: `?page=menu`

#### B) Cadastro Validado (`cadastroValidacao.html` > `cadastroFinal.html`)

* Verifica√ß√£o cruzada com base `FUSMAOFF` (aba `ValidacaoFusma`)
* Ap√≥s valida√ß√£o: cria login e senha com consentimento LGPD

#### C) Login Administrativo (`loginAdmin.html`)

* Acesso restrito a administradores cadastrados na aba `LoginAdminOnibus`
* Link "Primeiro acesso" redireciona para `validarCadastroAdminOnibus.html`

---

### üìÖ 2. Marca√ß√£o de √înibus

#### A) Tela `onibus.html`

* Carrega datas ativas da aba `ConfigOnibus`
* Gatilho de checagem para impedir agendamentos duplicados
* Fluxos diferenciados para viagens **com** ou **sem acompanhante**

#### B) Com vaga dispon√≠vel

1. Tela `instrucoesOnibus.html`
2. Tela de formul√°rio (com ou sem acompanhante)
3. Envio para `registrarAgendamento()`
4. Registra em:

   * `Agendamentos`
   * `HistoricoUsuarios`
   * `HistoricoGeralUsuarios`
   * `Registro_Onibus`

#### C) Sem vaga - Fila de Espera

* Exibe op√ß√£o de reserva com assento `R01`, `R02` etc.
* Registra em `Reservas` e `LogsFilaEspera`

---

### üöå 3. Fila de Espera

* Regra: promo√ß√£o at√© 24h antes feita por `processarAlocacaoFilaDiaria()`
* Promo√ß√µes ap√≥s isso s√≥ manualmente pelo admin
* Assentos 3 e 4 priorizam PCD

---

### ‚úÖ 4. Meus Agendamentos

* Tela `meusAgendamentos.html`
* Exibe:

  * Confirmados (‚úÖ)
  * Reservas (üïó)
* Permite cancelamento com rastreabilidade e aciona promo√ß√£o

---

### üë• 5. Cadastro de Admins

* Tela `validarCadastroAdminOnibus.html` verifica:

  * NIP existente
  * ATIVO = SIM
  * SENHA\_HASH em branco
* Se aprovado, redireciona para `cadastroSenhaAdminOnibus.html`
* Armazena:

  * `nipCadastroAdmin`, `nomeCadastroAdmin`, `emailCadastroAdmin` em `sessionStorage`

---

### üìÑ 6. Logs e Auditoria

* Toda a√ß√£o √© registrada em `Registro_Onibus`
* Campos:

  * acao, status anterior/atual, nip, nome, data, destino, assento, origem, observacao
* Logs espec√≠ficos tamb√©m em `LogsFilaEspera`, `HistoricoUsuarios`, `Cancelamentos`

---

### üë©‚Äçüíª 7. Painel Administrativo (`adminOnibus.html`)

#### üåê Requisitos de acesso

* `sessionStorage` com `nipAdminOnibus` e `nomeAdminOnibus`
* Roteado por `?page=adminOnibus`

#### üîπ Fun√ß√µes Dispon√≠veis

| Fun√ß√£o                     | Descri√ß√£o                                                           |
| -------------------------- | ------------------------------------------------------------------- |
| **Filtro de Data/Destino** | Define opera√ß√£o corrente                                            |
| **Gerenciar Datas**        | Aba `ConfigOnibus`: ativar/inativar datas para marca√ß√£o             |
| **Listar Agendados**       | Lista passageiros, permite `Cancelar` ou `Lancar Falta`             |
| **Fila de Espera**         | Permite `Promover` ou `Cancelar reservas`                           |
| **Libera√ß√£o Dirigida**     | Libera assento para um NIP espec√≠fico com justificativa             |
| **Lista de Presen√ßa**      | Gera documento com nome/NIP/assento/PCD/assinatura para cada viagem |

---

### ‚öñÔ∏è 8. Seguran√ßa e Conformidade

* Criptografia de senha no cliente
* Valida√ß√£o dupla em Apps Script (login e permiss√µes)
* Controle total por sessionStorage
* Conformidade com LGPD: consentimento e finalidade clara

---

### üìÅ 9. Estrutura de C√≥digo

#### Scripts Principais

* `Login.gs`, `CadastroValidado.gs`, `MarcacaoOnibus.gs`, `AdminOnibus.gs`, `Utilitarios.gs`, `Controlador.gs`

#### HTMLs Associados

* login, cadastroValidacao, cadastroFinal, onibus, meusAgendamentos, adminOnibus, loginAdmin, validarCadastroAdminOnibus, cadastroSenhaAdminOnibus

#### Abas da Planilha

* `UsuariosCadastrados`, `LoginAdminOnibus`, `Agendamentos`, `Reservas`, `HistoricoUsuarios`, `Registro_Onibus`, `Cancelamentos`, `ConfigOnibus`, `AssentosOnibus`, `LogsFilaEspera`, `Avisos`

---

### ‚úÖ Conclus√£o

O sistema da PNSPA proporciona uma solu√ß√£o digital robusta, segura e audit√°vel para o gerenciamento de transporte institucional, atendendo normas militares e requisitos modernos de usabilidade, acessibilidade e LGPD. A nova interface administrativa amplia o controle e a efici√™ncia dos gestores da rotina de √¥nibus.
