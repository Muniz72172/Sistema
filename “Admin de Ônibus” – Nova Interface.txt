â€œAdmin de Ã”nibusâ€ â€“ Nova Interface

ğŸšª Fluxo Inicial â€“ Acesso Administrativo de Ã”nibus (Atualizado)
1. loginAdmin.html
Campos: NIP, Senha

AÃ§Ãµes:

Entrar â†’ envia nip + senha (SHAâ€‘256 + Base64) para validarLoginAdminOnibus(nip, hash)

Requer SENHA_HASH preenchido e ATIVO = SIM

Link â€œPrimeiro acesso? Cadastre sua senhaâ€ â†’ redireciona para ?page=validarCadastroAdminOnibus

2. validarCadastroAdminOnibus.html
Campo Ãºnico: NIP

VerificaÃ§Ãµes (Apps Script): buscarCadastroAdminOnibus(nip)

Existe na aba LoginAdminOnibus?

EstÃ¡ com ATIVO = SIM?

Campo SENHA_HASH estÃ¡ em branco?

Resultado:

Se OK:

Armazena em sessionStorage: nipCadastroAdmin, nomeCadastroAdmin, emailCadastroAdmin

Redireciona para ?page=cadastroSenhaAdminOnibus

Se NÃƒO:

Alerta: â€œNIP nÃ£o autorizado ou jÃ¡ cadastrado.â€

3. cadastroSenhaAdminOnibus.html
Campos (preenchidos automaticamente com sessionStorage):

NIP, Nome, Email (readonly)

Nova Senha, Confirmar Senha

Regras:

Senhas devem coincidir

Hash gerado no cliente e enviado para registrarSenhaAdminOnibus(nip, hash)

SENHA_HASH e CADASTRADO_EM atualizados

Ao finalizar:

Limpa sessionStorage (nipCadastroAdmin, nomeCadastroAdmin, emailCadastroAdmin)

Redireciona para ?page=loginAdmin

ğŸ” SeguranÃ§a
AutenticaÃ§Ã£o com criptografia SHAâ€‘256 + Base64 (no cliente)

SessionStorage local para dados temporÃ¡rios

Acesso ao painel adminOnibus.html somente com sessionStorage vÃ¡lido

Roteamento controlado via doGet(e) com ?page=



ğŸ§‘â€ğŸ’¼ Tela â€œAdmin de Ã”nibusâ€ â€“ Nova Interface
Nome do HTML: adminOnibus.html
Script associado: AdminOnibus.gs

AcessÃ­vel somente por: usuÃ¡rios com perfil adminOnibus

ğŸ§© Funcionalidades
Filtro por Data e Destino

SeleÃ§Ã£o dinÃ¢mica via input date e select.

Gerenciar Datas de Agendamento

Leitura/escrita em ConfigOnibus.

LiberaÃ§Ã£o manual por destino e data.

Listar Agendados

Nome, NIP, Assento, PCD, Acompanhante.

BotÃµes: Cancelar, LanÃ§ar Falta (com justificativa).

Listar Fila de Espera (Reservas)

Ordem, PCD.

AÃ§Ãµes: Promover (manual), Cancelar.

LiberaÃ§Ã£o Dirigida de Assento Cinza

Indicar data, assento, nip, justificativa.

Libera assento especÃ­fico apenas para NIP informado.

Gerar Lista de PresenÃ§a

Layout para impressÃ£o.

Campos: NÂº, NIP, Nome, Assento, PCD, Acompanhante, Assinatura.

Gera log automÃ¡tico em Registro_Onibus.

ğŸ“‚ Scripts a Serem Criados
Script	FunÃ§Ãµes principais
AdminOnibus.gs	getAgendados(), cancelarPorAdmin(), lancarFalta(), promoverReserva(), liberarAssentoParaUsuario(), gerarListaPresenca(), registrarEventoOnibus()
Utilitarios.gs	Verificar perfil, formatar datas, validar sessÃ£o
doGet(e)	Direcionamento dinÃ¢mico de acordo com perfil ou ?page=

